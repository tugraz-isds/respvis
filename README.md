# RespVis

The goal of this framework is to make building responsive
visualisations as easy as possible while also providing mechanisms for
powerful customisation and extensibility. This is achieved by merging
SVG-based components with a layouting engine based on the CSS grid
syntax.

A live version of the `master` branch can be found at
[respvis.netlify.app](https://respvis.netlify.app/).

A live version of the current `develop` branch can be found at
[respvis-dev.netlify.app](https://respvis-dev.netlify.app/).

##
***

# Commands

## Installing

The framework is built on the Node ecosystem. Before attempting to do
anything else, all the dependencies need to be installed:

```
npm install
```

## Gulp Build And Development

Gulp is used to automate repeatable tasks. The [gulpfile](gulpfile.js)
works as the entrypoint for gulp and contains three public tasks.
- The clean task removes existing `package` and `dist` directories in
order to enable a clean rebuild of the project.
- The build task first executes the clean task, then creates a new build 
of the framework and copies the self-contained examples into the freshly
created `dist` folder.
- The serve task first executes the build task, then additionally executes
a private task called watcher which has two responsibilities: First, the 
browser-sync package is used to initialize a live server which serves the
`dist` directory. Then, file watchers are initiated which automatically
update the `dist` folder when making any relevant changes in the `src` folder 
and notify browsers to reload the page.

The public tasks can be invoked either by directly running gulp via npx or
by running the equivalent scripts in package.json:

```
npm run clean
npx gulp clean

npm run build
npx gulp build

npm run start
npx gulp serve
```

##
***

# Workflow

All [examples](src/examples) should be fully self-contained,
so all files necessary for serving a chart should be in
an own folder. However, all charts have dependencies which are
the same and copying them all manually in their own directory would
not be adaptable to future adjustments, not even to small changes in
the library.

Therefore, there exists an own directory 
[examples-dependencies](src/examples-dependencies) which is dedicated to 
holding all dependencies that could be of interest for all examples. 
Said dependencies can be, for example, the datasets, default styles and
library bundles. When the build task is executed, all necessary files are
copied into the right place of the examples. 

***The generated files are not meant to be pushed to the repository, 
therefore they are included in the gitignore. When adding new chart
examples or data it is important to keep this in mind and update the 
[Paths](gulp-tasks/paths.js) and [Path Mappings](gulp-tasks/copyPathData.js)
accordingly. These are part of the [subtasks](gulp-tasks) of gulp. Changes
to the subtasks will influence what and where files are generated from gulp***



## File Structures

### Chart Example File Structure

The following file structure must be applied when adding a new chart to 
[examples](src/examples) in
order to achieve a unified consistent set (files generated by gulp are marked):
```
├── <chart>
│   ├── <chart>.css
│   ├── <chart>.html
│   ├── <chart>.scss
│   ├── chooseResponsiveData.js
│   ├── data (generated)
│   │   ├── <dataset>.js (generated)
│   │   └── source.txt (generated)
│   ├── libs (generated)
│   │   ├── d3-7.6.0 (generated)
│   │   │   ├── d3.js (generated)
│   │   │   ├── d3.min.js (generated)
│   │   │   └── LICENSE (generated)
│   │   └── respvis (generated)
│   │       └── respvis.js (generated)
│   └── styles (generated)
│       └── respvis.css (generated)
```

### Development File Structure

The following file structure gives an overview about the existing gulp
tasks. Tasks which must be adapted when adding new chart examples are marked
accordingly (files generated by gulp are marked):
```
├── gulp-tasks
│   ├── buildSCSS.js
│   ├── bundleDeclaration.js
│   ├── bundleJS.js
│   ├── copyExampleDependencies.js
│   ├── copyExamples.js
│   ├── copyPathData.js (add new copy data tasks here)
│   ├── copyPathLibs.js
│   ├── copyPathStyles.js
│   ├── createExampleDependencies.js
│   ├── paths.js (add new example paths here)
│   └── watcher.js
├── src
│   ├── examples-dependencies
│   │   ├── data
│   │   │   ├── <dataset> (when adding a new dataset follow this schema)
│   │   │   │   ├── <dataset>.js
│   │   │   │   └── source.txt
│   │   ├── libs (generated)
│   │   │   ├── d3-7.6.0 (generated)
│   │   │   │   ├── d3.js (generated)
│   │   │   │   ├── d3.min.js (generated)
│   │   │   │   └── LICENSE (generated)
│   │   │   └── respvis (generated)
│   │   │       └── respvis.js (generated)
│   │   └── styles (generated)
│   │       └── respvis.css (generated)


```

## Deployment

To test a built version you have to deploy the `dist` folder to a web
server, or open the `dist/index.html` file directly in a browser (make
sure your browser CORS policy [allows local file
requests](https://dev.to/dengel29/loading-local-files-in-firefox-and-chrome-m9f)).
